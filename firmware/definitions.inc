; Макросы и определения

; Регистры GPIORx
; GPIOR0.0 - флаг переноса BCD
; GPIOR0.1 - используется как вспомогательный флаг при опросе клавиатуры
; GPIOR0.2 - устанавливается в 1 каждую десятую долю секунды
; GPIOR0.3 - ...каждую секунду
; GPIOR0.4 - ...минуту
; GPIOR0.5 - ...час
; GPIOR0.6 - ...день
; GPIOR0.7 - ...месяц

;------- Константы
.equ num_mode = 0x02
.equ sec_part = 8
.equ OCR2A_val = 127
.equ TimCntVal = 32

.equ cRed = 0b11100000 	; стандартные цвета
.equ cGreen = 0b00011100
.equ cBlue = 0b00000011
.equ cYellow = 0b11111100
.equ cMagenta = 0b11100011
.equ cCyan = 0b00011111
.equ cWhite = 0b11111111
.equ cBlack = 0x00
.equ cGray = 0b10110110
.equ cDarkGray = 0b01101101
;-------

;------- Определения
; r0,r1 - используются при аппаратном mul
.def lcd_X = r2	; Текущие координаты
.def lcd_Y = r3
.def bkg_color = r4 ; Цвета фона и текста
.def frg_color = r5
.def lcd_mx = r6	; множители масштабирования
.def lcd_my = r7

.def kbd = r8	; Битовая маска нажатых кнопок
.def led_timer=r9	; Таймер подсветки (1/8 секундные интерваллы)
.def sec_part_cnt = r10 ; счетчик долей секунды

; r11 - свободен

.def kbd_prev = r12	; Битовая маска нажатых кнопок предыдущего такта
.def kbd_press = r13 ; Нажатые кнопки (из 1 в 0)
.def kbd_release = r14 ; Отпущенные кнопки (из 0 в 1)

; r15 - свободен

.def tmp=r16	; Temp
.def tmp1=r17
.def tmp2=r18	; Используется таймером для отсчета интервалов задержек

.def mode=r19	; Режим работы: 0 - часы (отображение даты-времени), 1 - настройка даты, времени,
				; 2 - таймер, 3 - секундомер 

; r20 - используется в подпрограммах для дисплея
; r21 - один раз используется в подпрограмме для дисплея

.def snd_flag = r22 ; регистр флагов для звука. Содержит индекс на текущий сэмпл, если равен 0 - то звук не играется, если больше нуля - то значение-1 - номер сэмпла

.def refresh = r23	; Регистр с флагами обновления
; Биты:
; 0 - надо обновить минуты
; 1 - часы
; 2 - число/день недели
; 3 - месяц
; 4 - год
; 5 - обновление таймера
; 6 - таймер запущен(1)/остановлен(0)
; 7 - флаг отработки ЦНХ
; т.к. рисование идет не быстрее чем раз в секунду, то секунды обновляются каждый такт и так
.def mode_tmp=r24 ; Для режима 1 - здесь хранится текущий редактируемый параметр (час, минута, секунда и т.д.)
				  ; 0 - час, 1 - минута, 2 - секунда, 3 - число, 4 - день недели, 5 - месяц, 6 - год (пока так)
				  ; этот же параметр и указывает какая часть рисуемой даты-времени будет подсвечена

.def snd = r25 ; регистр длительности звука/паузы

.def style = r26 ; стиль отображения времени: 0 - цифры, 1 - цифры в стиле 7-ми сегментного индикатора, 2 - бианрные

; r26, r27 - X (не задействован)
; r28, r29 - Y (используется в ЦНХ)
; r30, r31 - Z (используется везде)
;-------

;------- Макросы
.macro CS_LOW
	cbi PORTB, 1
	nop
.endm
.macro CS_HIGH
	sbi PORTB, 1
	nop
.endm
.macro LED_ON
	sbi PORTC, 1
	nop
.endm
.macro LED_OFF
	cbi PORTC, 1
	nop
.endm
.macro CMD_SET
	cbi PORTB, 0
	nop
.endm
.macro DATA_SET
	sbi PORTB, 0
	nop
.endm
.macro LCD_RESET_LOW
	cbi PORTC, 0
	nop
.endm
.macro LCD_RESET_HIGH
	sbi PORTC, 0
	nop
.endm
.macro LAPZ
	ldi ZH, high(@0 << 1)
	ldi ZL, low(@0 << 1)
.endm
.macro LASZ
	ldi ZH, high(@0)
	ldi ZL, low(@0)
.endm
.macro BEEP_ON
	sbi PORTC, 2
	nop
.endm
.macro BEEP_OFF
	cbi PORTC, 2
	nop
.endm
;-------
